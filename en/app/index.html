<!-- /en/app/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SafeShare App – clean links (local-first)</title>
  <meta name="description" content="Paste a link → SafeShare removes tracking parameters (utm_*, fbclid, gclid …) locally in your browser. Copy / Share. No upload." />
  <meta name="robots" content="index,follow" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b1020" />

  <link rel="canonical" href="https://safesharepro.com/en/app/" />
  <link rel="alternate" hreflang="de" href="https://safesharepro.com/app/" />
  <link rel="alternate" hreflang="en" href="https://safesharepro.com/en/app/" />
  <link rel="alternate" hreflang="x-default" href="https://safesharepro.com/en/app/" />

  <!-- Open Graph -->
  <meta property="og:title" content="SafeShare App – clean links (local-first)" />
  <meta property="og:description" content="Paste a link → remove tracking parameters locally. Copy / Share. No upload." />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="SafeShare" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://safesharepro.com/en/app/" />
  <meta property="og:image" content="https://safesharepro.com/assets/og/og-app.png?v=2026-01-25-03" />
  <meta property="og:image:alt" content="SafeShare App preview" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SafeShare App – clean links (local-first)" />
  <meta name="twitter:description" content="Paste a link → remove tracking parameters locally. Copy / Share. No upload." />
  <meta name="twitter:image" content="https://safesharepro.com/assets/og/og-app.png?v=2026-01-25-03" />

  <!-- Favicons + PWA -->
  <link rel="icon" type="image/svg+xml" href="/assets/fav/favicon.svg?v=2025-12-26-01">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/fav/favicon-32.png?v=2025-12-26-01">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/fav/favicon-16.png?v=2025-12-26-01">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/fav/apple-touch-icon-180.png?v=2025-12-26-01">
  <link rel="manifest" href="/manifest.webmanifest?v=2025-12-26-01">

  <!-- MASTER SHELL -->
  <link rel="stylesheet" href="/css/ss-shell.css?v=2026-01-25-03">
  <script src="/js/ss-shell.js?v=2026-01-25-03" defer></script>

  <style>
    :root{
      --bg0:#070a12; --bg1:#070b14; --bg2:#0b1020;
      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.60);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --radius: 18px;
      --mint2: rgba(47,227,183,.18);
      --mint3: rgba(47,227,183,.28);
      --warn: rgba(255,197,84,.16);
      --ok: rgba(47,227,183,.16);
      --bad: rgba(255,106,106,.14);
      --max: 1120px;
      --focus: 0 0 0 3px rgba(47,227,183,.22);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg0:#f6f7fb; --bg1:#ffffff; --bg2:#f2f6ff;
        --card:#ffffff;
        --border: rgba(17,24,39,.12);
        --text: rgba(17,24,39,.95);
        --muted: rgba(17,24,39,.72);
        --muted2: rgba(17,24,39,.62);
        --shadow: 0 18px 45px rgba(17,24,39,.10);
        --warn: rgba(255,197,84,.22);
        --ok: rgba(47,227,183,.18);
        --bad: rgba(255,106,106,.14);
        --focus: 0 0 0 3px rgba(17,130,98,.22);
      }
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(47,227,183,.18), transparent 55%),
        radial-gradient(900px 520px at 85% 10%, rgba(255,197,84,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0) 55%, var(--bg2));
    }
    a{ color:inherit; }
    .wrap{ max-width:var(--max); margin:0 auto; padding: 12px 16px 44px; }
    .grid{ display:grid; gap: 14px; grid-template-columns: 1.15fr .85fr; align-items:start; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }

    h1{ margin: 10px 0 8px; font-size: clamp(22px, 3.8vw, 40px); line-height: 1.10; letter-spacing:-.2px; }
    h2{ margin: 0 0 8px; font-size: 16px; letter-spacing: -0.1px; }
    p{ margin: 0 0 12px; color: var(--muted); line-height: 1.6; }

    .sub{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; color: var(--muted2); font-size: 13px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      text-decoration:none;
      user-select:none;
    }
    .pill strong{ color: var(--text); font-weight: 800; }
    .pill.ok{ border-color: rgba(47,227,183,.25); background: var(--ok); color: var(--text); }
    .pill.warn{ border-color: rgba(255,197,84,.25); background: var(--warn); color: var(--text); }

    .ta{
      width:100%;
      min-height: 140px;
      resize: vertical;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline: none;
      font-size: 14px;
      line-height: 1.45;
    }
    @media (prefers-color-scheme: light){
      .ta{ background: rgba(17,24,39,.03); border-color: rgba(17,24,39,.12); }
      .pill{ border-color: rgba(17,24,39,.12); background: rgba(17,24,39,.03); }
    }
    .ta:focus{ box-shadow: var(--focus); border-color: rgba(47,227,183,.35); }

    .row{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; margin-top: 12px; }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 14px;
      cursor:pointer;
      user-select:none;
      display:inline-flex; align-items:center; gap: 8px;
      text-decoration:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }
    .btn.primary{ background: var(--mint2); border-color: rgba(47,227,183,.35); }
    .btn.primary:hover{ background: var(--mint3); }
    .btn.ghost{ background: transparent; color: var(--muted); }
    .btn.ghost:hover{ color: var(--text); background: rgba(255,255,255,.04); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }

    .out{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      line-height: 1.5;
      color: var(--text);
      white-space: pre-wrap;
      word-break: break-word;
    }
    @media (prefers-color-scheme: light){
      .out{ background: rgba(17,24,39,.03); border-color: rgba(17,24,39,.12); }
    }

    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 520px){ .kpi{ grid-template-columns: 1fr; } }
    .kpiBox{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .kpiTop{ display:flex; justify-content:space-between; gap: 10px; align-items: baseline; }
    .kpiLabel{ color: var(--muted2); font-size: 12px; }
    .kpiVal{ font-weight: 900; font-size: 20px; letter-spacing: -.2px; }

    .session{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 12px;
    }
    .sessionHead{ display:flex; justify-content:space-between; align-items:center; gap: 10px; }
    .sessionTitle{ font-weight: 900; }
    .sessionSmall{ color: var(--muted2); font-size: 12px; }
    .log{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .log strong{ color: var(--text); }
    @media (prefers-color-scheme: light){
      .session, .kpiBox{ border-color: rgba(17,24,39,.12); background: rgba(17,24,39,.03); }
      .log{ border-color: rgba(17,24,39,.12); background: rgba(17,24,39,.03); }
    }

    .note,.warn,.bad{
      margin-top: 12px;
      border-left: 3px solid rgba(47,227,183,.55);
      background: var(--ok);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.45;
      color: var(--text);
    }
    .warn{ border-left-color: rgba(255,197,84,.55); background: var(--warn); }
    .bad{ border-left-color: rgba(255,106,106,.55); background: var(--bad); }

    .examples{
      display:grid; gap: 10px; grid-template-columns: 1fr;
      margin-top: 12px;
    }
    .exItem{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.45;
      cursor: pointer;
      user-select:none;
    }
    .exItem:hover{ background: rgba(255,255,255,.06); color: var(--text); }
    @media (prefers-color-scheme: light){
      .exItem{ border-color: rgba(17,24,39,.12); background: rgba(17,24,39,.03); }
      .exItem:hover{ background: rgba(17,24,39,.06); }
    }

    footer{
      margin-top: 18px;
      padding: 10px 2px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.55;
    }
    .footLinks{ display:flex; gap: 10px; flex-wrap: wrap; }
    .footLinks a{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      text-decoration:none;
    }
    .footLinks a:hover{ color: var(--text); background: rgba(255,255,255,.06); }
    @media (prefers-color-scheme: light){
      .footLinks a{ border-color: rgba(17,24,39,.12); background: rgba(17,24,39,.03); }
      .footLinks a:hover{ background: rgba(17,24,39,.06); }
    }
  </style>

  <!-- Schema.org -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"SafeShare",
    "applicationCategory":"UtilitiesApplication",
    "operatingSystem":"Web",
    "url":"https://safesharepro.com/en/app/",
    "description":"Clean links locally in your browser by removing tracking parameters. No upload.",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"EUR"}
  }
  </script>
</head>

<body>
  <div id="ss-shell"></div>

  <div class="wrap">
    <section class="card">
      <h1>SafeShare App</h1>
      <p>Paste a link → remove tracking parameters locally in your browser. Copy / Share.</p>

      <div class="sub">
        <span class="pill ok"><strong>Local-first</strong> no upload</span>
        <span class="pill">Removes <strong>utm_*</strong>, <strong>gclid</strong>, <strong>fbclid</strong> …</span>
        <a class="pill" href="/en/help/">Help</a>
        <a class="pill" href="/en/pro/">Pro</a>
      </div>

      <textarea id="in" class="ta" spellcheck="false" autocapitalize="off" autocomplete="off"
        placeholder="Paste a link here…"></textarea>

      <div class="row">
        <button id="btnClean" class="btn primary" type="button">Clean</button>
        <button id="btnCopy" class="btn" type="button" disabled>Copy</button>
        <button id="btnShare" class="btn" type="button" disabled>Share</button>
        <button id="btnExamples" class="btn ghost" type="button">Load examples</button>
        <button id="btnClear" class="btn ghost" type="button">Clear</button>
      </div>

      <div id="msg"></div>

      <div id="out" class="out" hidden></div>

      <div class="kpi" aria-label="Session counters">
        <div class="kpiBox">
          <div class="kpiTop"><div class="kpiLabel">Links cleaned</div><div class="kpiVal" id="kLinks">0</div></div>
        </div>
        <div class="kpiBox">
          <div class="kpiTop"><div class="kpiLabel">Parameters removed</div><div class="kpiVal" id="kParams">0</div></div>
        </div>
        <div class="kpiBox">
          <div class="kpiTop"><div class="kpiLabel">Redirects unwrapped</div><div class="kpiVal" id="kUnwrap">0</div></div>
        </div>
      </div>

      <!-- Session block: looks like a small log entry UNDER the tiles -->
      <div class="session" aria-label="Session info">
        <div class="sessionHead">
          <div class="sessionTitle">Session (this tab)</div>
          <div class="sessionSmall" id="sessionHint">No data yet</div>
        </div>
        <div class="log" id="lastLog">
          <strong>Last:</strong> —
        </div>
      </div>

      <div class="warn" style="margin-top:12px;">
        Important: removing tracking parameters does not make you “invisible”. Websites can still log access and may track via cookies, accounts, or fingerprinting.
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <h2>What SafeShare changes</h2>
        <p>SafeShare removes typical tracking parameters and can unwrap common redirect wrappers (when the target URL is embedded in a parameter).</p>

        <div class="examples" id="examples" hidden>
          <div class="exItem" data-ex="https://example.com/page?utm_source=newsletter&utm_medium=email&utm_campaign=launch&gclid=123&x=ok#section">
            Example 1 (UTM + gclid)
          </div>
          <div class="exItem" data-ex="https://l.example/redirect?url=https%3A%2F%2Fshop.example%2Fproduct%3Futm_source%3Dsocial%26fbclid%3Dabc%26ref%3Dkeepme">
            Example 2 (redirect wrapper + fbclid)
          </div>
          <div class="exItem" data-ex="https://www.youtube.com/watch?v=dQw4w9WgXcQ&feature=youtu.be&si=abc123&utm_source=share">
            Example 3 (mixed params)
          </div>
          <div class="exItem" data-ex="https://www.amazon.example/dp/B000000?tag=affiliate123&utm_source=ads&utm_medium=cpc">
            Example 4 (affiliate + UTM — note: affiliate might be intentional)
          </div>
        </div>

        <div class="note">
          Tip: Some parameters are functional (filters, language, product IDs) or intentional (affiliate/ref). Pro adds audit + allowlists/policies.
        </div>

        <div class="row">
          <a class="btn" href="/en/privacy/">Privacy</a>
          <a class="btn" href="/en/imprint/">Imprint</a>
          <a class="btn ghost" href="/app/">Deutsch</a>
        </div>
      </section>

      <section class="card">
        <h2>Support</h2>
        <p>If you have listing questions or want to report a broken wrapper pattern, contact:</p>
        <p style="margin:0;">
          <a href="mailto:listings@safesharepro.com">listings@safesharepro.com</a>
        </p>

        <div class="note" style="margin-top:12px;">
          This page runs fully client-side. No input is sent to SafeShare servers.
        </div>

        <footer>
          <div class="footLinks">
            <a href="/en/">Home</a>
            <a href="/en/help/">Help</a>
            <a href="/en/pro/">Pro</a>
            <a href="/en/terms/">Terms</a>
          </div>
        </footer>
      </section>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const $ = (id) => document.getElementById(id);

      const inEl = $("in");
      const outEl = $("out");
      const msgEl = $("msg");

      const btnClean = $("btnClean");
      const btnCopy = $("btnCopy");
      const btnShare = $("btnShare");
      const btnExamples = $("btnExamples");
      const btnClear = $("btnClear");

      const exWrap = $("examples");
      const kLinks = $("kLinks");
      const kParams = $("kParams");
      const kUnwrap = $("kUnwrap");
      const sessionHint = $("sessionHint");
      const lastLog = $("lastLog");

      const TRACKING_KEYS = new Set([
        // Ad/Click IDs
        "gclid","dclid","gbraid","wbraid",
        "fbclid","msclkid","igshid",
        "twclid","ttclid","li_fat_id",
        "yclid",
        // Newsletter/CRM
        "mc_cid","mc_eid","mkt_tok",
        "_hsenc","_hsmi",
        // Google Search
        "srsltid",
        // Analytics IDs (often removable)
        "_ga","_gid","_gac",
        "_fbp","_fbc",
        // common
        "obclid","tblci"
      ]);

      const REDIRECT_KEYS = [
        "url","u","target","dest","destination","to","redirect","redir","redirect_url",
        "redirecturi","redirect_uri","r","ru","continue","next","out","link"
      ];

      const state = {
        linksCleaned: 0,
        paramsRemoved: 0,
        unwraps: 0,
        last: null
      };

      function esc(s){
        return String(s).replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
      }

      function setMessage(kind, html){
        if (!html){
          msgEl.innerHTML = "";
          return;
        }
        const cls = kind === "warn" ? "warn" : kind === "bad" ? "bad" : "note";
        msgEl.innerHTML = `<div class="${cls}">${html}</div>`;
      }

      function normalizeUrlText(s){
        if (!s) return "";
        return String(s).trim();
      }

      function looksLikeUrl(s){
        if (!s) return false;
        const t = s.trim();
        return /^https?:\/\//i.test(t) || /^www\./i.test(t);
      }

      function toURL(s){
        let t = s.trim();
        if (/^www\./i.test(t)) t = "https://" + t;
        try { return new URL(t); }
        catch { return null; }
      }

      function lowerKeys(params){
        const out = [];
        for (const [k,v] of params.entries()){
          out.push([String(k), String(v)]);
        }
        return out;
      }

      function isUTM(k){
        return k.toLowerCase().startsWith("utm_");
      }

      function shouldRemoveKey(k){
        const kl = k.toLowerCase();
        if (isUTM(kl)) return true;
        return TRACKING_KEYS.has(kl);
      }

      function tryUnwrap(u, depthMax=3){
        let depth = 0;
        let cur = u;
        let unwrappedCount = 0;

        while (depth < depthMax){
          depth++;

          let found = null;
          for (const key of REDIRECT_KEYS){
            const v = cur.searchParams.get(key);
            if (!v) continue;

            // decode once or twice (some wrappers double-encode)
            let cand = v;
            try { cand = decodeURIComponent(cand); } catch {}
            try { cand = decodeURIComponent(cand); } catch {}

            // sometimes embedded URL has prefix
            cand = cand.trim();

            // accept only http(s)
            if (/^https?:\/\//i.test(cand)){
              found = cand;
              break;
            }
          }

          if (!found) break;

          const next = toURL(found);
          if (!next) break;

          cur = next;
          unwrappedCount++;
        }

        return { url: cur, unwraps: unwrappedCount };
      }

      function cleanOnce(raw){
        const u0 = toURL(raw);
        if (!u0) return { ok:false, err:"No valid URL found." };

        // unwrap redirect wrappers (common)
        const unwrapped = tryUnwrap(u0, 3);
        const u = unwrapped.url;

        const beforePairs = lowerKeys(u.searchParams);
        let removed = [];

        // remove tracking keys
        for (const [k, v] of beforePairs){
          if (shouldRemoveKey(k)){
            u.searchParams.delete(k);
            removed.push(k);
          }
        }

        // also remove empty utm_ keys (already covered) + common duplicates
        // (keep functional params by default)

        // normalize: sort params for stability (optional)
        // NOTE: URLSearchParams keeps insertion order; we rebuild sorted
        const kept = [];
        for (const [k,v] of u.searchParams.entries()) kept.push([k,v]);
        kept.sort((a,b)=>a[0].localeCompare(b[0]));
        u.search = "";
        for (const [k,v] of kept) u.searchParams.append(k,v);

        return {
          ok:true,
          out: u.toString(),
          removedKeys: removed,
          removedCount: removed.length,
          unwraps: unwrapped.unwraps,
          hadUnwrap: unwrapped.unwraps > 0
        };
      }

      function updateKpis(){
        kLinks.textContent = String(state.linksCleaned);
        kParams.textContent = String(state.paramsRemoved);
        kUnwrap.textContent = String(state.unwraps);

        if (state.linksCleaned === 0){
          sessionHint.textContent = "No data yet";
        } else {
          sessionHint.textContent = "Counts reset when you close this tab";
        }

        if (!state.last){
          lastLog.innerHTML = "<strong>Last:</strong> —";
        } else {
          const t = new Date(state.last.ts);
          const time = t.toLocaleString(undefined, { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
          lastLog.innerHTML =
            `<strong>Last:</strong> ${time}<br>` +
            `${esc(state.last.out)}<br>` +
            `<span style="color:var(--muted2)">Removed: ${state.last.removedCount} · Unwrapped: ${state.last.unwraps}</span>`;
        }
      }

      async function copyText(s){
        try{
          await navigator.clipboard.writeText(s);
          return true;
        }catch{
          // fallback
          const ta = document.createElement("textarea");
          ta.value = s;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          let ok = false;
          try{ ok = document.execCommand("copy"); }catch{}
          ta.remove();
          return ok;
        }
      }

      async function shareText(s){
        if (navigator.share){
          try{
            await navigator.share({ text: s, url: s });
            return true;
          }catch{
            return false;
          }
        }
        return false;
      }

      function renderResult(out){
        outEl.hidden = false;
        outEl.textContent = out;
      }

      function setButtons(hasOut){
        btnCopy.disabled = !hasOut;
        btnShare.disabled = !hasOut;
      }

      function onClean(){
        setMessage(null, "");
        const raw = normalizeUrlText(inEl.value);

        // extract first url-like token if user pasted text
        let candidate = raw;
        if (!looksLikeUrl(candidate)){
          const m = raw.match(/https?:\/\/[^\s<>"']+/i) || raw.match(/www\.[^\s<>"']+/i);
          if (m) candidate = m[0];
        }

        const r = cleanOnce(candidate);

        if (!r.ok){
          renderResult("");
          outEl.hidden = true;
          setButtons(false);
          setMessage("bad", esc(r.err) + " Paste a full link starting with https://");
          return;
        }

        renderResult(r.out);
        setButtons(true);

        // counters
        state.linksCleaned += 1;
        state.paramsRemoved += r.removedCount;
        state.unwraps += r.unwraps;

        state.last = {
          ts: Date.now(),
          out: r.out,
          removedCount: r.removedCount,
          unwraps: r.unwraps
        };

        const removedInfo = r.removedCount === 1 ? "1 parameter removed" : `${r.removedCount} parameters removed`;
        const unwrapInfo = r.unwraps ? ` · ${r.unwraps} redirect${r.unwraps===1?"":"s"} unwrapped` : "";
        setMessage("note", `<strong>Done.</strong> ${removedInfo}${unwrapInfo}.`);

        updateKpis();
      }

      async function onCopy(){
        if (outEl.hidden) return;
        const s = outEl.textContent.trim();
        if (!s) return;
        const ok = await copyText(s);
        setMessage(ok ? "note" : "warn", ok ? "Copied to clipboard." : "Could not copy automatically. Select and copy manually.");
      }

      async function onShare(){
        if (outEl.hidden) return;
        const s = outEl.textContent.trim();
        if (!s) return;
        const ok = await shareText(s);
        if (!ok){
          const copied = await copyText(s);
          setMessage(copied ? "note" : "warn", copied
            ? "Share is not available here. Link copied to clipboard."
            : "Share is not available here. Please copy manually.");
        }
      }

      function onExamples(){
        exWrap.hidden = !exWrap.hidden;
        if (!exWrap.hidden){
          setMessage("note", "Tap an example to load it into the input.");
        } else {
          setMessage(null, "");
        }
      }

      function onClear(){
        inEl.value = "";
        outEl.textContent = "";
        outEl.hidden = true;
        setButtons(false);
        setMessage(null, "");
        inEl.focus();
      }

      // events
      btnClean.addEventListener("click", onClean);
      btnCopy.addEventListener("click", onCopy);
      btnShare.addEventListener("click", onShare);
      btnExamples.addEventListener("click", onExamples);
      btnClear.addEventListener("click", onClear);

      inEl.addEventListener("keydown", (e)=>{
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter"){
          onClean();
        }
      });

      exWrap.addEventListener("click", (e)=>{
        const t = e.target.closest("[data-ex]");
        if (!t) return;
        inEl.value = t.getAttribute("data-ex") || "";
        exWrap.hidden = true;
        setMessage(null, "");
        onClean();
      });

      // initial state
      updateKpis();
      setButtons(false);
    })();
  </script>
</body>
</html>
