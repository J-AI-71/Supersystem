<!doctype html><html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SafeShare – Tools v160</title>
<link rel="icon" href="favicon-32.png">
<style>
*{box-sizing:border-box}body{margin:16px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;color:#111827}
h1{margin:0 0 8px;font-size:20px}.muted{color:#6b7280;font-size:12px}
.card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;margin:10px 0}
.btn{display:inline-block;border:1px solid #e5e7eb;border-radius:10px;padding:8px 10px;background:#fff;color:#111827;text-decoration:none;margin-right:8px;cursor:pointer}
.kbd{font:12px ui-monospace,Menlo,Consolas,monospace;background:#f8fafc;border:1px solid #e5e7eb;border-radius:6px;padding:2px 6px}
#log{margin-top:8px;font:12px ui-monospace,Menlo,Consolas,monospace;color:#7f1d1d;white-space:pre-wrap}
</style>
</head><body>
<h1>SafeShare – Tools <span class="muted">v160</span></h1>

<div class="card">
  <button class="btn" id="btnClearCaches">Caches löschen</button>
  <button class="btn" id="btnUnreg">SW abmelden</button>
  <button class="btn" id="btnLocalReset">Profile zurücksetzen</button>
  <button class="btn" id="btnOpenApp">App mit neuem ?v öffnen</button>
  <div id="log"></div>
  <p class="muted">Nutze danach harte Neu-Ladung: <span class="kbd">Strg/⌘+Shift+R</span></p>
</div>

<script>
const log=(m)=>{ const el=document.getElementById('log'); el.textContent=(el.textContent?el.textContent+"\n":"")+m; };

document.getElementById('btnClearCaches').onclick=async()=>{
  try{
    if(navigator.serviceWorker?.controller){
      navigator.serviceWorker.controller.postMessage('CLEAR_CACHES');
    }
    const keys=await caches.keys();
    await Promise.all(keys.map(k=>caches.delete(k)));
    log('Caches gelöscht.');
  }catch(e){ log('Fehler Caches: '+e.message); }
};

document.getElementById('btnUnreg').onclick=async()=>{
  try{
    const regs=await navigator.serviceWorker.getRegistrations();
    await Promise.all(regs.map(r=>r.unregister()));
    log('Service Worker abgemeldet.');
  }catch(e){ log('Fehler SW: '+e.message); }
};

document.getElementById('btnLocalReset').onclick=()=>{
  try{
    const keys=Object.keys(localStorage);
    for(const k of keys){ if(k.startsWith('ss_')) localStorage.removeItem(k); }
    log('Lokale Profile gelöscht.');
  }catch(e){ log('Fehler LocalStorage: '+e.message); }
};

document.getElementById('btnOpenApp').onclick=()=>{
  const v=Date.now().toString().slice(-6);
  window.open('app.html?v='+v, '_blank');
};

// SW registrieren, damit CLEAR_CACHES funktioniert
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js?v=7').catch(()=>{});
}
</script>
</body></html>