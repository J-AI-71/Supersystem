<!doctype html><meta charset="utf-8"><title>Icon-Generator</title>
<base href="/Supersystem/">
<style>
  body{font:16px/1.5 system-ui;padding:2rem;max-width:720px;margin:auto}
  button{padding:.6rem 1rem;border:1px solid #999;border-radius:10px;background:none;cursor:pointer}
  .row{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
  input[type=file]{border:1px solid #ccc;padding:.4rem .6rem;border-radius:8px}
</style>
<h1>SafeShare Icon-Generator</h1>
<p>Erzeugt PNGs aus <code>logo.svg</code> in 180, 192 und 512 px.</p>

<div class="row">
  <label><input id="bg" type="checkbox" checked> weißen Hintergrund füllen (empfohlen für iOS)</label>
  <button id="go">PNG-Dateien erzeugen</button>
</div>

<p>Falls <code>logo.svg</code> nicht gefunden wird, lade hier dein SVG hoch:</p>
<div class="row">
  <input id="file" type="file" accept=".svg,image/svg+xml">
</div>

<pre id="out">Bereit…</pre>

<script>
(async function(){
  const sizes = [180,192,512];
  const out = document.getElementById('out');
  const bg = document.getElementById('bg');
  const file = document.getElementById('file');

  function log(...m){ out.textContent += '\n' + m.join(' '); }
  function reset(msg){ out.textContent = msg || '…'; }

  async function loadSvgText(){
    // 1) Datei-Upload hat Vorrang, wenn gewählt
    if (file.files && file.files[0]) {
      const txt = await file.files[0].text();
      log('SVG aus Datei geladen:', file.files[0].name);
      return txt;
    }
    // 2) Fallback-Pfade testen
    const candidates = [
      'logo.svg',
      '/Supersystem/logo.svg',
      './logo.svg',
      '../logo.svg',
      '../Supersystem/logo.svg'
    ];
    for (const url of candidates) {
      try {
        const r = await fetch(url, {cache:'no-store'});
        if (r.ok) { log('SVG gefunden unter:', url); return await r.text(); }
        else log('Nicht gefunden:', url, r.status);
      } catch(e){ log('Fehler bei', url); }
    }
    throw new Error('logo.svg nicht gefunden. Lege die Datei unter /Supersystem/ ab oder lade ein SVG hoch.');
  }

  async function makePngs(svgText){
    const svgUrl = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgText);
    const img = new Image(); img.crossOrigin = 'anonymous'; img.src = svgUrl;
    await new Promise(r => img.onload = r);

    for (const size of sizes) {
      const c = document.createElement('canvas'); c.width = c.height = size;
      const ctx = c.getContext('2d');
      if (bg.checked) { ctx.fillStyle = '#fff'; ctx.fillRect(0,0,size,size); }
      // Vollflächig zeichnen (SVG skaliert verlustfrei)
      ctx.drawImage(img, 0, 0, size, size);

      const a = document.createElement('a');
      a.download = `icon-${size}.png`;
      a.href = c.toDataURL('image/png');
      a.click();
      log('Erzeugt:', a.download);
    }
    log('Fertig. Lade die PNGs nach Supersystem/icons/ hoch.');
  }

  document.getElementById('go').addEventListener('click', async ()=>{
    try {
      reset('Starte…');
      const svg = await loadSvgText();
      await makePngs(svg);
    } catch(e) {
      log(e.message || String(e));
    }
  });
})();
</script>