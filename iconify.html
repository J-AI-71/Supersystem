<!doctype html><meta charset="utf-8">
<title>SafeShare Icon-Generator</title>
<base href="/Supersystem/">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font:16px/1.6 system-ui;padding:20px;max-width:900px;margin:auto;background:Canvas;color:CanvasText}
  button{padding:.6rem 1rem;border:1px solid color-mix(in oklab,CanvasText 30%,transparent);border-radius:10px;background:none;cursor:pointer}
  .row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
  .card{border:1px solid color-mix(in oklab,CanvasText 20%,transparent);border-radius:12px;padding:12px;margin:12px 0}
  .tile{display:inline-grid;place-items:center;border:1px dashed #bbb;margin:.5rem;padding:.5rem;
        background:
        linear-gradient(45deg,#eee 25%,transparent 25%),
        linear-gradient(-45deg,#eee 25%,transparent 25%),
        linear-gradient(45deg,transparent 75%,#eee 75%),
        linear-gradient(-45deg,transparent 75%,#eee 75%);
        background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0}
  .hint{opacity:.8}
  img{display:block}
  code{font-family:ui-monospace,Menlo,Consolas,monospace}
</style>

<h1>SafeShare Icon-Generator</h1>
<p>Erzeugt PNGs aus <code>logo.svg</code> (oder hochgeladenem SVG) in 180, 192 und 512&nbsp;px.</p>

<div class="row">
  <label><input id="bg" type="checkbox" checked> weißen Hintergrund füllen (empfohlen für iOS)</label>
  <input id="file" type="file" accept=".svg,image/svg+xml">
  <button id="go">PNG erzeugen</button>
</div>

<div id="out" class="hint">Bereit…</div>
<div id="list"></div>

<script>
(async function(){
  const SIZES=[180,192,512];
  const out=document.getElementById('out');
  const list=document.getElementById('list');
  const bg=document.getElementById('bg');
  const file=document.getElementById('file');

  function log(msg){ out.textContent = msg; }

  async function loadSvg(){
    if (file.files && file.files[0]) {
      return await file.files[0].text();
    }
    // versuche logo.svg an typischer Stelle
    const candidates=['logo.svg','./logo.svg','/Supersystem/logo.svg'];
    for (const u of candidates){
      try{ const r=await fetch(u,{cache:'no-store'}); if(r.ok) return await r.text(); }catch{}
    }
    throw new Error('logo.svg nicht gefunden. Lade ein SVG über den Datei-Button hoch.');
  }

  async function raster(svgText, size){
    const url='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svgText);
    const img=new Image(); img.crossOrigin='anonymous'; img.src=url;
    await new Promise(res => img.onload=res);
    const c=document.createElement('canvas'); c.width=c.height=size;
    const ctx=c.getContext('2d');
    if (bg.checked){ ctx.fillStyle='#fff'; ctx.fillRect(0,0,size,size); }
    ctx.drawImage(img, 0, 0, size, size);
    const blob=await new Promise(res => c.toBlob(res, 'image/png'));
    const objUrl=URL.createObjectURL(blob);
    return {blob, objUrl};
  }

  function rowFor(size, objUrl, blob){
    const wrap=document.createElement('div');
    wrap.className='card';
    wrap.innerHTML = `
      <h3>icon-${size}.png</h3>
      <div class="tile" style="width:${Math.min(size,256)}px;height:${Math.min(size,256)}px">
        <img src="${objUrl}" width="${Math.min(size,256)}" height="${Math.min(size,256)}" alt="icon-${size}.png Vorschau">
      </div>
      <div class="row">
        <a class="openBtn" href="${objUrl}" target="_blank" rel="noopener">
          <button type="button">Öffnen (neuer Tab)</button>
        </a>
        <a class="dlBtn" download="icon-${size}.png">
          <button type="button">Download (Desktop)</button>
        </a>
        <button type="button" class="shareBtn">Teilen (Datei)</button>
        <span class="hint">iPhone: „Öffnen“ → Teilen → „In Dateien sichern“ <em>oder</em> Bild lange drücken → „In Fotos sichern“.</span>
      </div>
    `;
    // set download href (Data-URL) – besser für Desktop
    (async () => {
      const buf = await blob.arrayBuffer();
      const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      wrap.querySelector('.dlBtn').href = 'data:image/png;base64,'+b64;
    })();

    // Web Share Level 2 (Dateien)
    wrap.querySelector('.shareBtn').addEventListener('click', async () => {
      if (!navigator.canShare || !navigator.canShare({ files: [new File([blob], `icon-${size}.png`, {type:'image/png'})] })) {
        alert('Datei-Teilen wird von diesem Browser nicht unterstützt. Nutze „Öffnen“ und sichere über das Teilen-Menü.');
        return;
      }
      try {
        await navigator.share({
          files: [new File([blob], `icon-${size}.png`, {type:'image/png'})],
          title: `icon-${size}.png`,
          text: 'Speichere in „Dateien“, dann auf GitHub hochladen.'
        });
      } catch {}
    });
    return wrap;
  }

  document.getElementById('go').addEventListener('click', async () => {
    list.innerHTML=''; log('Erzeuge…');
    try {
      const svg = await loadSvg();
      for (const s of SIZES) {
        const {blob, objUrl} = await raster(svg, s);
        list.appendChild(rowFor(s, objUrl, blob));
      }
      log('Fertig. Speichere jede PNG und lade sie nach Supersystem/icons/ hoch.');
    } catch(e){ log(e.message || String(e)); }
  });
})();
</script>