<!-- /Supersystem/tests.html (noindex, interne Diagnose) -->
<!doctype html>
<html lang="de">
<head>
  <!-- Basis -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <base href="/Supersystem/">
  <title>Tests (intern) · SafeShare</title>
  <link rel="canonical" href="https://j-ai-71.github.io/Supersystem/tests.html">
  <meta name="robots" content="noindex, nofollow, noarchive">

  <!-- PWA / Icons -->
  <link rel="manifest" href="manifest.webmanifest?v=20251122">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-32-kreis.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/icon-16-kreis.png">
  <meta name="theme-color" content="#0b0b0b">
  <meta name="color-scheme" content="light dark">

  <!-- Sicherheits-CSP (Inline-Script via Nonce) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 base-uri 'self';
                 frame-ancestors 'none';
                 object-src 'none';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'nonce-SSTEST';
                 font-src 'self';
                 worker-src 'self';
                 manifest-src 'self';
                 connect-src 'self'">

  <!-- Styles -->
  <style>
    :root{--bg:#0b0b0b;--fg:#e9eef1;--mut:#aab6bf;--card:#0f141a;--line:#26313a;--pri:#2bd184;--bad:#ef4444}
    @media(prefers-color-scheme:light){
      :root{--bg:#ffffff;--fg:#0b0b0b;--mut:#5f6368;--card:#f6f8fa;--line:#e2e8f0;--pri:#22c07b;--bad:#b91c1c}
    }
    html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:1000px;margin:0 auto;padding:24px}
    .mut{color:var(--mut)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-top:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#12181e;color:var(--fg);text-decoration:none;cursor:pointer}
    .btn.pri{background:var(--pri);border-color:transparent;color:#062012;font-weight:700}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    table{width:100%;border-collapse:collapse;border:1px solid var(--line)}
    th,td{padding:8px;border-top:1px solid var(--line);text-align:left}
    th{color:var(--mut)}
    .ok{color:#1dd1a1}
    .bad{color:var(--bad)}
  </style>

  <!-- JS -->
  <script defer src="js/sw-register.js?v=20251122"></script>
  <script nonce="SSTEST">
    async function checkSW(){
      const out = document.getElementById('sw-out');
      out.textContent = 'Prüfe …';
      try {
        const reg = await navigator.serviceWorker.getRegistration();
        if (!reg) { out.innerHTML = '<span class="bad">Kein Service Worker registriert</span>'; return; }
        const s = reg.active ? 'aktiv' : (reg.waiting ? 'wartend' : 'installiert (kein Controller)');
        out.innerHTML = `Status: <strong>${s}</strong><br>Scope: <code>${reg.scope}</code>`;
      } catch(e){
        out.innerHTML = '<span class="bad">Fehler bei SW-Prüfung</span>';
      }
    }
    async function listCaches(){
      const ul = document.getElementById('cache-list');
      ul.innerHTML = '';
      try{
        const keys = await caches.keys();
        if (keys.length === 0){ ul.innerHTML = '<li class="mut">Keine Caches</li>'; return; }
        keys.forEach(k => {
          const li = document.createElement('li'); li.textContent = k; ul.appendChild(li);
        });
      }catch(e){ ul.innerHTML = '<li class="bad">Fehler beim Auslesen</li>'; }
    }
    async function clearCaches(){
      const ul = document.getElementById('cache-list');
      try{
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
        ul.innerHTML = '<li>Gelöscht.</li>';
      }catch(e){ ul.innerHTML = '<li class="bad">Löschen fehlgeschlagen</li>'; }
    }
    function checkLocal(){
      const pro = localStorage.getItem('ss_pro') || localStorage.getItem('safeshare.pro');
      const wl  = localStorage.getItem('ss_whitelist');
      document.getElementById('pro-state').textContent = pro ? 'aktiv' : 'nicht aktiv';
      document.getElementById('wl-state').textContent  = wl ? 'gesetzt' : 'leer';
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('btn-sw').addEventListener('click', checkSW);
      document.getElementById('btn-caches').addEventListener('click', listCaches);
      document.getElementById('btn-clear').addEventListener('click', clearCaches);
      document.getElementById('btn-local').addEventListener('click', checkLocal);
    });
  </script>
</head>
<body>
  <div class="wrap">
    <header class="row" style="justify-content:space-between">
      <div>
        <h1>Interne Tests</h1>
        <p class="mut">Schneller Zustandstest für SW, Caches und lokale Flags.</p>
      </div>
      <div class="row">
        <a class="btn" href="./">Startseite</a>
        <a class="btn" href="status.html">Status</a>
        <a class="btn" href="app.html">App</a>
      </div>
    </header>

    <section class="card">
      <h2 style="margin-top:0">Service Worker</h2>
      <div class="row" style="margin-top:6px">
        <button id="btn-sw" class="btn pri" type="button">SW prüfen</button>
        <span id="sw-out" class="mut">–</span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin-top:0">Caches</h2>
      <div class="row" style="margin-top:6px">
        <button id="btn-caches" class="btn" type="button">Auflisten</button>
        <button id="btn-clear" class="btn" type="button">Alle löschen</button>
      </div>
      <ul id="cache-list" style="margin-top:8px"></ul>
      <p class="mut">Tipp: Nach <code>sw.js</code>-Versionbump Seite mit <code>?nocache=YYYYMMDD</code> neu laden.</p>
    </section>

    <section class="card">
      <h2 style="margin-top:0">Lokale Flags</h2>
      <div class="row" style="margin-top:6px">
        <button id="btn-local" class="btn" type="button">Prüfen</button>
        <span class="mut">Pro: <strong id="pro-state">–</strong> • Whitelist: <strong id="wl-state">–</strong></span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin-top:0">Schnelllinks</h2>
      <div class="row">
        <a class="btn" href="bookmarklets.html">Bookmarklets</a>
        <a class="btn" href="bulk-clean.html">Bulk-Clean</a>
        <a class="btn" href="redirect-entschachteln.html">Redirects entpacken</a>
        <a class="btn" href="team-setup.html">Team-Setup</a>
        <a class="btn" href="help.html">Hilfe</a>
      </div>
    </section>
  </div>

  <noscript><div class="wrap"><div class="card">Bitte JavaScript aktivieren, um die Tests auszuführen.</div></div></noscript>
</body>
</html>
