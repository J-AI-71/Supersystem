<!doctype html><html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SafeShare – Link-Reiniger</title>
</head><body>
<h1>SafeShare – Link-Reiniger</h1>
<p>Entfernt <code>utm_</code>, <code>gclid</code>, <code>fbclid</code>, <code>twclid</code>. Funktionscodes bleiben.</p>

<textarea id="in" placeholder="Link(s) hier einfügen. Eine Zeile pro Link." style="width:100%;height:140px"></textarea>
<div style="margin:10px 0">
  <button id="clean">Säubern</button>
  <button id="copy">Kopieren</button>
  <button id="open">Öffnen</button>
  <button id="clear" title="Leeren" style="width:38px">×</button>
</div>
<textarea id="out" readonly placeholder="Bereinigte URL(s) erscheinen hier..." style="width:100%;height:140px"></textarea>

<p style="font-size:12px"><a id="bm" href="#">Bookmarklet: UTM jetzt säubern</a> · <a href="impressum.html">Impressum</a> · <a href="datenschutz.html">Datenschutz</a></p>

<script>
function cleanOne(s){
  try{
    const u=new URL(s.trim());
    const kill=['fbclid','gclid','twclid','msclkid','mc_cid','mc_eid','igshid','vero_id','wickedid'];
    [...u.searchParams.keys()].forEach(k=>{
      if(k.startsWith('utm_')||kill.includes(k)) u.searchParams.delete(k);
    });
    u.hash='';
    return u.toString();
  }catch(e){ return s.trim(); }
}

function runClean(){
  const lines=in.value.split('\n').map(x=>x.trim()).filter(Boolean);
  out.value = lines.map(cleanOne).join('\n');
}

clean.onclick = runClean;
copy.onclick  = async ()=>{ if(!out.value) return; try{ await navigator.clipboard.writeText(out.value); alert('Kopiert'); }catch(e){} };
open.onclick  = ()=>{ const t=out.value.split('\n').find(Boolean); if(t) location.href=t; };
clear.onclick = ()=>{ in.value=''; out.value=''; in.focus(); };

const js="javascript:(function(){try{var u=new URL(location.href);var kill=['fbclid','gclid','twclid','msclkid','mc_cid','mc_eid','igshid','vero_id','wickedid'];u.hash='';u.searchParams.forEach(function(v,k){if(k.indexOf('utm_')===0||kill.indexOf(k)>-1)u.searchParams.delete(k)});location.replace(u.toString())}catch(e){alert('Kein gültiger Link')}})()";
bm.href=js;

// Auto-Bereinigung per ?u=
(function(){
  const p=new URLSearchParams(location.search);
  const q=p.get('u')||p.get('url');
  if(q){ in.value=decodeURIComponent(q); runClean(); }
})();
</script>
</body></html>