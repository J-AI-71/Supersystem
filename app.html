<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SafeShare App – Tracking-Parameter aus Links entfernen</title>
  <meta name="description" content="SafeShare entfernt Tracking-Parameter aus Links – lokal im Browser. Bereinigte Links kopieren oder teilen. Ohne Konto." />
  <meta name="robots" content="index,follow" />
  <meta name="color-scheme" content="dark light" />

  <!-- Google Search Console -->
  <meta name="google-site-verification" content="3-mi6zLHRdFC14-RdTIF6GY90jKWfyLNLsFBhGLqQB0" />
  <!-- Bing Webmaster Tools -->
  <meta name="msvalidate.01" content="B18ACE18875F9614DAA5CF69EED40ACE" />

  <style>
    :root{
      --bg0:#070a12;
      --bg1:#070b14;
      --bg2:#0b1020;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.045);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.60);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --radius: 18px;
      --mint: #2fe3b7;
      --mint2: rgba(47,227,183,.18);
      --mint3: rgba(47,227,183,.28);
      --warn: rgba(255,197,84,.16);
      --bad: rgba(255,95,95,.16);
      --focus: 0 0 0 3px rgba(47,227,183,.22);
      --max: 1060px;
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg0:#f6f7fb;
        --bg1:#ffffff;
        --bg2:#f2f6ff;
        --card:#ffffff;
        --card2:#f5f7ff;
        --border: rgba(17,24,39,.12);
        --text: rgba(17,24,39,.95);
        --muted: rgba(17,24,39,.72);
        --muted2: rgba(17,24,39,.62);
        --shadow: 0 18px 45px rgba(17,24,39,.10);
        --warn: rgba(255,197,84,.22);
        --bad: rgba(255,95,95,.18);
        --focus: 0 0 0 3px rgba(17, 130, 98, .22);
      }
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(47,227,183,.18), transparent 55%),
        radial-gradient(900px 520px at 85% 10%, rgba(255,197,84,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0) 55%, var(--bg2));
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:var(--max); margin:0 auto; padding: 18px 16px 44px; }

    /* Header / Nav (wie dein Layout) */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 6px 16px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      gap: 16px;
    }
    .brand{
      display:flex; align-items:center; gap: 10px; min-width:0;
    }
    .mark{
      width:36px; height:36px; border-radius: 999px;
      display:grid; place-items:center;
      border:1px solid var(--border);
      background: linear-gradient(135deg, rgba(47,227,183,.25), rgba(255,197,84,.10));
      box-shadow: var(--shadow);
      flex:0 0 auto;
    }
    .mark span{
      font-weight: 800;
      color: var(--mint);
      font-size: 14px;
    }
    .brandText{ min-width:0; }
    .brandText .title{
      font-size: 16px; font-weight: 750; margin:0; line-height:1.15;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brandText .sub{
      display:block; font-size: 12px; color: var(--muted2);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      margin-top: 2px;
    }
    nav{
      display:flex; align-items:center; gap: 14px; flex-wrap:wrap; justify-content:flex-end;
    }
    .navlink{
      font-size: 13px;
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
    }
    .navlink:hover{ border-color: var(--border); background: rgba(255,255,255,.04); }
    .navlink.active{
      color: var(--text);
      border-color: rgba(47,227,183,.35);
      background: rgba(47,227,183,.10);
    }

    /* Main */
    .hero{
      padding: 22px 6px 12px;
    }
    .hero h1{
      margin: 0 0 10px;
      font-size: clamp(22px, 4vw, 36px);
      line-height: 1.12;
      letter-spacing: -0.2px;
    }
    .hero p{
      margin:0 0 14px;
      color: var(--muted);
      max-width: 72ch;
      line-height: 1.5;
    }
    .chips{ display:flex; gap: 10px; flex-wrap:wrap; margin-top: 10px; }
    .chip{
      padding: 8px 10px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 10px;
    }
    @media(min-width: 940px){
      .grid{ grid-template-columns: 1.1fr .9fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 8px;
    }

    textarea, input[type="text"]{
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: var(--card2);
      color: var(--text);
      padding: 12px 12px;
      font-size: 15px;
      outline:none;
    }
    textarea{ min-height: 92px; resize: vertical; }
    textarea:focus, input[type="text"]:focus{ box-shadow: var(--focus); border-color: rgba(47,227,183,.35); }

    .row{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; margin-top: 12px; }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 14px;
      cursor:pointer;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }
    .btn.primary{
      background: var(--mint2);
      border-color: rgba(47,227,183,.35);
      color: var(--text);
    }
    .btn.primary:hover{ background: var(--mint3); }
    .btn.danger{
      background: var(--bad);
      border-color: rgba(255,95,95,.30);
    }
    .btn.link{
      background: transparent;
      border-color: rgba(255,255,255,.10);
      color: var(--muted);
    }
    .btn.link:hover{ color: var(--text); }

    .status{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
    }
    .status.ok{ color: rgba(47,227,183,.95); }
    .status.bad{ color: rgba(255,95,95,.95); }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-size: 12px;
      color: var(--muted);
    }

    .resultBox{ display:flex; gap: 10px; flex-wrap:wrap; align-items:flex-start; }
    .resultBox input{ flex: 1 1 420px; }

    details{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
    }
    details > summary{
      cursor:pointer;
      font-weight: 650;
      font-size: 13px;
      color: var(--text);
      list-style: none;
    }
    details > summary::-webkit-details-marker{ display:none; }

    .receiptBlock{ margin-top: 10px; display:grid; gap: 10px; }
    .rcItem{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .rcItem strong{ display:block; font-size: 13px; margin-bottom: 4px; }
    .keys{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: var(--muted);
      word-break: break-word;
      line-height: 1.45;
    }
    .hint{
      border-left: 3px solid rgba(255,197,84,.55);
      background: var(--warn);
      padding: 10px 12px;
      border-radius: 12px;
      color: var(--text);
      font-size: 13px;
    }

    .small{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.45;
    }
    .sep{ height:1px; background: rgba(255,255,255,.08); margin: 12px 0; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="mark" aria-hidden="true"><span>8</span></div>
        <div class="brandText">
          <div class="title">SafeShare</div>
          <span class="sub">Links teilen. Ohne Ballast.</span>
        </div>
      </div>

      <nav aria-label="Navigation">
        <a class="navlink active" href="app.html">App</a>
        <a class="navlink" href="pro-app.html">Pro</a>
        <a class="navlink" href="hilfe.html">Hilfe</a>
        <a class="navlink" href="bookmarklets.html">Bookmarklets</a>
      </nav>
    </div>

    <section class="hero">
      <h1>Links säubern – lokal im Browser.</h1>
      <p>
        SafeShare entfernt UTM-Tags, Klick-IDs und typische Tracking-Parameter, bevor du Links kopierst oder teilst.
        Der Unterschied: Du siehst transparent, <em>was</em> entfernt wurde.
      </p>
      <div class="chips">
        <span class="chip">läuft im Browser</span>
        <span class="chip">kein Login, kein Konto</span>
        <span class="chip">Fokus: Datensparsamkeit</span>
      </div>
    </section>

    <div class="grid">
      <!-- Input -->
      <section class="card">
        <label for="urlInput">Link einfügen</label>
        <textarea id="urlInput" placeholder="https://…" autocapitalize="off" autocomplete="off" spellcheck="false"></textarea>

        <div class="row">
          <button class="btn" id="pasteBtn" type="button">Aus Zwischenablage</button>
          <button class="btn primary" id="cleanBtn" type="button">Säubern</button>
          <button class="btn danger" id="clearBtn" type="button">Leeren</button>
        </div>

        <div class="status" id="statusMsg"></div>

        <div class="sep"></div>

        <div class="small">
          Standard-Modus: <strong>Privat</strong>.
          Unbekannte Parameter werden standardmäßig behalten, damit Links nicht kaputtgehen.
          In <strong>Pro</strong> kannst du Presets, Domain-Regeln und Parameter-Toggles nutzen.
        </div>
      </section>

      <!-- Output -->
      <section class="card" aria-live="polite">
        <div class="pill" id="modePill">Ergebnis</div>

        <div id="emptyState" class="small" style="margin-top:10px;">
          Hier erscheint der bereinigte Link.
        </div>

        <div id="outputSection" hidden style="margin-top:10px;">
          <label for="cleanedOutput">Bereinigter Link</label>
          <div class="resultBox">
            <input id="cleanedOutput" type="text" readonly />
            <a class="btn" id="openBtn" href="#" target="_blank" rel="noopener">Öffnen</a>
          </div>

          <div class="row">
            <button class="btn primary" id="copyBtn" type="button">Kopieren</button>
            <button class="btn" id="shareBtn" type="button">Teilen</button>
            <a class="btn link" id="goPro" href="pro-app.html">Details & Regeln (Pro)</a>
            <button class="btn danger" id="undoBtn" type="button">Undo (Original)</button>
          </div>

          <!-- Receipt -->
          <div class="small" id="receiptSummary" style="margin-top:10px;"></div>

          <details>
            <summary>Was wurde geändert?</summary>

            <div class="receiptBlock">
              <div class="rcItem">
                <strong>Entfernt</strong>
                <div id="receiptRemoved" class="keys">—</div>
              </div>

              <div class="rcItem">
                <strong>Behalten</strong>
                <div id="receiptKept" class="keys">—</div>
              </div>

              <div class="hint" id="receiptHint" hidden>
                Hinweis: Manche Seiten nutzen signierte Parameter. Wenn etwas nicht funktioniert, nutze <strong>Undo (Original)</strong>.
              </div>
            </div>
          </details>
        </div>
      </section>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const ui = {
      input: $("urlInput"),
      paste: $("pasteBtn"),
      clean: $("cleanBtn"),
      clear: $("clearBtn"),
      msg: $("statusMsg"),

      emptyState: $("emptyState"),
      outputSection: $("outputSection"),
      cleanedOutput: $("cleanedOutput"),
      openBtn: $("openBtn"),
      copyBtn: $("copyBtn"),
      shareBtn: $("shareBtn"),
      undoBtn: $("undoBtn"),
      goPro: $("goPro"),
      modePill: $("modePill"),

      receiptSummary: $("receiptSummary"),
      receiptRemoved: $("receiptRemoved"),
      receiptKept: $("receiptKept"),
      receiptHint: $("receiptHint"),
    };

    let lastOriginal = "";
    let lastCleaned  = "";

    const CATEGORY_LABEL = {
      CLICK_ID: "Werbe-Klick-IDs",
      UTM: "Kampagnen-Tracking",
      EMAIL: "E-Mail/Newsletter",
      EXPERIMENT: "A/B/Experimente",
      AFFILIATE: "Affiliate/Referral",
      OTHER_TRACK: "Allgemeines Tracking",
      UNKNOWN: "Unbekannt (behalten)"
    };

    function setMsg(text, kind=""){
      ui.msg.textContent = text || "";
      ui.msg.className = "status" + (kind ? " " + kind : "");
    }

    function normalizeUrl(raw){
      let s = String(raw || "").trim();
      if (!s) return "";
      // simple domain -> add https://
      if (!/^https?:\/\//i.test(s) && /^[a-z0-9.-]+\.[a-z]{2,}(\/|$)/i.test(s)) {
        s = "https://" + s;
      }
      return s;
    }

    function categorizeParam(k){
      const key = String(k || "");
      if (/^utm_/i.test(key)) return "UTM";
      if (/(^|_)(gclid|dclid|gbraid|wbraid|msclkid|fbclid|ttclid|twclid|igshid)$/i.test(key)) return "CLICK_ID";
      if (/^(mc_cid|mc_eid|mkt_tok|oly_anon_id|oly_enc_id|vero_id|vero_conv)$/i.test(key)) return "EMAIL";
      if (/^(abtest|variant|experiment|bucket|hsctatracking|__hsfp|__hssc|__hstc)$/i.test(key)) return "EXPERIMENT";
      if (/^(ref|tag|aff|aff_id|affid|partner|partner_id|ascsubtag|clickref|irclickid)$/i.test(key)) return "AFFILIATE";
      if (/^(source|spm|scm|cmpid|campaignid|ad_id|adgroupid|creative|keyword|matchtype|device|gclsrc|fb_action_ids|fb_action_types)$/i.test(key)) return "OTHER_TRACK";
      return "UNKNOWN";
    }

    // Free/Privat: remove common trackers; keep unknowns to avoid breaking links
    function shouldRemoveInFree(key){
      const k = String(key || "");
      if (/^utm_/i.test(k)) return true;
      if (/(^|_)(gclid|dclid|gbraid|wbraid|msclkid|fbclid|ttclid|twclid|igshid)$/i.test(k)) return true;
      if (/^(mc_cid|mc_eid|mkt_tok|oly_anon_id|oly_enc_id|vero_id|vero_conv)$/i.test(k)) return true;
      if (/^(abtest|variant|experiment|bucket|hsctatracking|__hsfp|__hssc|__hstc)$/i.test(k)) return true;

      // Affiliate im Free/Privat standardmäßig raus (Pro kann behalten)
      if (/^(ref|tag|aff|aff_id|affid|partner|partner_id|ascsubtag|clickref|irclickid)$/i.test(k)) return true;

      return false;
    }

    function cleanUrl(rawUrl){
      const url = new URL(rawUrl);
      const removed = [];
      const kept = [];

      const entries = Array.from(url.searchParams.entries());
      url.search = "";

      for (const [k,v] of entries){
        const cat = categorizeParam(k);
        if (shouldRemoveInFree(k)){
          removed.push({ key:k, value:v, category:cat });
        } else {
          kept.push({ key:k, value:v, category:cat });
          url.searchParams.append(k, v);
        }
      }

      return { cleaned: url.toString(), removed, kept, host: url.host };
    }

    function renderResult(original, result){
      lastOriginal = original;
      lastCleaned = result.cleaned;

      ui.emptyState.hidden = true;
      ui.outputSection.hidden = false;

      ui.cleanedOutput.value = result.cleaned;
      ui.openBtn.href = result.cleaned;
      ui.modePill.textContent = "Ergebnis · Privat";

      // Pro bekommt die ORIGINAL-URL (wichtig für echte Kontrolle in Pro)
      const encoded = encodeURIComponent(original);
      ui.goPro.href = `pro-app.html?url=${encoded}`;

      ui.receiptSummary.textContent =
        `${result.removed.length} entfernt · ${result.kept.length} behalten · Domain: ${result.host}`;

      // Removed grouped by category
      const removedByCat = {};
      for (const r of result.removed){
        removedByCat[r.category] ||= [];
        removedByCat[r.category].push(r.key);
      }

      const removedLines = Object.entries(removedByCat).map(([cat, keys]) => {
        const uniq = [...new Set(keys)];
        const short = uniq.slice(0, 10).join(", ") + (uniq.length > 10 ? " …" : "");
        return `${CATEGORY_LABEL[cat] || cat}: ${short}`;
      });

      ui.receiptRemoved.textContent = removedLines.length ? removedLines.join(" · ") : "—";

      const keptKeys = [...new Set(result.kept.map(p => p.key))];
      ui.receiptKept.textContent =
        keptKeys.length ? (keptKeys.slice(0, 18).join(", ") + (keptKeys.length > 18 ? " …" : "")) : "—";

      const removedAffiliate = result.removed.some(r => r.category === "AFFILIATE");
      ui.receiptHint.hidden = !(result.removed.length >= 6 || removedAffiliate);
    }

    async function pasteFromClipboard(){
      try{
        if (navigator.clipboard?.readText){
          const text = await navigator.clipboard.readText();
          if (text){
            ui.input.value = text.trim();
            setMsg("Aus Zwischenablage eingefügt.", "ok");
          } else {
            setMsg("Zwischenablage ist leer.");
          }
        } else {
          setMsg("Zwischenablage nicht verfügbar. Bitte manuell einfügen.");
        }
      }catch(e){
        setMsg("Zugriff auf Zwischenablage nicht erlaubt. Bitte manuell einfügen.", "bad");
      }
    }

    async function copyToClipboard(text){
      try{
        if (navigator.clipboard?.writeText){
          await navigator.clipboard.writeText(text);
          setMsg("Kopiert.", "ok");
          return true;
        }
      }catch(e){}
      try{
        ui.cleanedOutput.focus();
        ui.cleanedOutput.select();
        document.execCommand("copy");
        setMsg("Kopiert.", "ok");
        return true;
      }catch(e){
        setMsg("Kopieren nicht verfügbar. Bitte manuell markieren.", "bad");
        return false;
      }
    }

    async function shareLink(url){
      try{
        if (navigator.share){
          await navigator.share({ title:"SafeShare", text:"Bereinigter Link", url });
          setMsg("Geteilt.", "ok");
          return true;
        }
        await copyToClipboard(url);
        return true;
      }catch(e){
        setMsg("Teilen abgebrochen.");
        return false;
      }
    }

    function runClean(){
      const raw = normalizeUrl(ui.input.value);
      if (!raw){
        setMsg("Bitte einen Link einfügen.", "bad");
        return;
      }
      if (!/^https?:\/\//i.test(raw)){
        setMsg("Nur http/https-Links werden unterstützt.", "bad");
        return;
      }

      try{
        const result = cleanUrl(raw);
        renderResult(raw, result);
        setMsg(result.removed.length ? "Link bereinigt." : "Keine typischen Tracking-Parameter gefunden.", "ok");
      }catch(e){
        setMsg("Das sieht nicht wie ein gültiger Link aus.", "bad");
      }
    }

    function clearAll(){
      ui.input.value = "";
      ui.cleanedOutput.value = "";
      ui.outputSection.hidden = true;
      ui.emptyState.hidden = false;
      ui.modePill.textContent = "Ergebnis";
      lastOriginal = "";
      lastCleaned = "";
      setMsg("");
    }

    ui.paste.addEventListener("click", pasteFromClipboard);
    ui.clean.addEventListener("click", runClean);
    ui.clear.addEventListener("click", clearAll);

    ui.copyBtn.addEventListener("click", () => {
      if (!lastCleaned) return;
      copyToClipboard(lastCleaned);
    });

    ui.shareBtn.addEventListener("click", () => {
      if (!lastCleaned) return;
      shareLink(lastCleaned);
    });

    ui.undoBtn.addEventListener("click", async () => {
      if (!lastOriginal) return;
      ui.cleanedOutput.value = lastOriginal;
      ui.openBtn.href = lastOriginal;
      await copyToClipboard(lastOriginal);
      setMsg("Original wiederhergestellt (kopiert).", "ok");
    });

    // optional: ?url=... prefill
    (function initFromQuery(){
      const qs = new URLSearchParams(location.search);
      const u = qs.get("url");
      if (u){
        try{
          const decoded = decodeURIComponent(u);
          ui.input.value = decoded;
          runClean();
        }catch(e){}
      }
    })();
  </script>
</body>
</html>
