// SafeShare Status-Check (in der Browser-Konsole auf einer beliebigen Seite ausführen)
// Prüft: <base>, Referrer-Policy, sw-register-Version, Quickstart-Link, Tools-Link entfernt, canonical
// Erwartete SW-Version hier ggf. anpassen:
(() => {
  const EXPECTED_VER = '2025-11-15-01';

  const html = document.documentElement.innerHTML;

  // SW-Register-Version aus dem <script>-Tag ermitteln
  function detectSwRegVersion() {
    const tag = [...document.scripts].find(s => /js\/sw-register\.js/i.test(s.src));
    const m = tag && tag.src.match(/[?&]v=([^&]+)/);
    return m ? m[1] : null;
  }

  const ver = detectSwRegVersion();

  // Checks
  const checks = {
    base_ok: /<base\s+href=["']\/Supersystem\/["']\s*>/i.test(html),
    referrer_ok:
      /<meta\s+name=["']referrer["']\s+content=["']no-referrer(?:-when-downgrade)?["']\s*>/i.test(html),
    sw_register_found: !!ver,
    sw_register_ok: ver === EXPECTED_VER,
    quickstart_link: /assets\/docs\/SafeShare-Quickstart-DE\.pdf/i.test(html),
    tools_link_removed: !/href=["']tools\.html["']/i.test(html),
    canonical_present: /<link\s+rel=["']canonical["'][^>]*>/i.test(html),
  };

  console.table({
    ...checks,
    sw_register_version: ver || 'not found',
    expected_version: EXPECTED_VER
  });

  // Zusatzinfos zum Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistration().then(reg => {
      console.log('[SW]', {
        has_controller: !!navigator.serviceWorker.controller,
        scope: reg ? reg.scope : 'none'
      });
    }).catch(e => console.log('[SW] getRegistration error:', e));
  } else {
    console.log('[SW] serviceWorker API not supported');
  }
})();
