<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>SafeShare Pro App – mehrere Links in Serie bereinigen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="SafeShare Pro App: bereinige mehrere Links in einem Rutsch und nutze eigene Regeln für Tracking-Parameter. Läuft lokal im Browser, ohne Konto, ohne Tracking." />
  <link rel="canonical" href="https://j-ai-71.github.io/Supersystem/pro-app.html" />

  <!-- Verifikation (identisch zu anderen Kernseiten) -->
  <meta name="google-site-verification" content="KFkKxZrXyKiS_KzE0YwkYAeXoLNKtQGjbeg9ocdBiOY" />
  <meta name="msvalidate.01" content="7BD74FEEFCA9C7B540613485C050EFF8" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SafeShare Pro App – mehrere Links in Serie bereinigen" />
  <meta property="og:description" content="Liste von Links einfügen, Tracking-Parameter nach deinen Regeln entfernen, bereinigte Liste kopieren – lokal im Browser, ohne Nutzerkonto." />
  <meta property="og:url" content="https://j-ai-71.github.io/Supersystem/pro-app.html" />
  <meta property="og:image" content="https://j-ai-71.github.io/Supersystem/social-preview.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SafeShare Pro App – mehrere Links in Serie bereinigen" />
  <meta name="twitter:description" content="SafeShare Pro hilft dir, mehrere Links in einem Rutsch zu bereinigen und eigene Regeln für Tracking-Parameter festzulegen." />
  <meta name="twitter:image" content="https://j-ai-71.github.io/Supersystem/social-preview.png" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #050814;
      --bg-elevated: #080d1a;
      --fg: #f5f7ff;
      --fg-muted: #9aa5d4;
      --accent: #3fe0b5;
      --accent-soft: rgba(63, 224, 181, 0.18);
      --accent-blue: #15bbff;
      --border-subtle: rgba(148, 163, 199, 0.32);
      --danger: #ff6b81;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #101732 0, #050814 52%, #03040a 100%);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px 16px 32px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px 6px 8px;
      margin-bottom: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 199, 0.38);
      background:
        linear-gradient(145deg, rgba(5, 8, 20, 0.9), rgba(8, 13, 26, 0.98));
      backdrop-filter: blur(14px);
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .brand-mark {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 0, rgba(255, 255, 255, 0.18), transparent 55%),
        radial-gradient(circle at 0 100%, rgba(63, 224, 181, 0.4), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(21, 187, 255, 0.35), transparent 65%),
        linear-gradient(145deg, #091426, #030711);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(148, 163, 199, 0.7);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), 0 10px 22px rgba(0, 0, 0, 0.7);
    }

    .brand-mark span {
      font-size: 15px;
      font-weight: 700;
      color: var(--accent);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .brand-text strong {
      font-size: 15px;
    }

    .brand-text span {
      font-size: 11px;
      color: var(--fg-muted);
    }

    .nav {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }

    .nav a {
      color: var(--fg-muted);
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid transparent;
      text-decoration: none;
      white-space: nowrap;
    }

    .nav a:hover {
      border-color: rgba(148, 163, 199, 0.5);
      color: var(--fg);
      background: radial-gradient(circle at 0 0, rgba(63, 224, 181, 0.15), transparent 60%);
    }

    .nav a.is-active {
      color: #020617;
      background: linear-gradient(135deg, var(--accent), var(--accent-blue));
      border-color: rgba(63, 224, 181, 0.85);
      box-shadow: 0 10px 26px rgba(63, 224, 181, 0.45);
    }

    @media (max-width: 720px) {
      .top-bar {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        border-radius: 18px;
      }
      .nav {
        justify-content: space-between;
        flex-wrap: wrap;
      }
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 880px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      padding: 18px 18px 16px;
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 199, 0.45);
      background:
        radial-gradient(circle at 0 0, rgba(63, 224, 181, 0.2), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(21, 187, 255, 0.18), transparent 55%),
        linear-gradient(145deg, var(--bg-elevated), #050814);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
      font-size: 13px;
    }

    .card h1 {
      margin: 0 0 8px;
      font-size: 20px;
    }

    .card p {
      margin: 0 0 8px;
      color: var(--fg-muted);
    }

    .card h2 {
      margin: 10px 0 6px;
      font-size: 15px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px 3px 4px;
      border-radius: 999px;
      border: 1px solid rgba(63, 224, 181, 0.45);
      background: radial-gradient(circle at 0 0, rgba(63, 224, 181, 0.32), transparent 65%);
      color: var(--fg-muted);
      font-size: 11px;
      margin-bottom: 10px;
    }

    .badge-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #befce6, #16a34a);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.9), 0 0 18px rgba(34, 197, 94, 0.7);
    }

    .io-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      margin-top: 6px;
    }

    .field-label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 12px;
      color: var(--fg-muted);
      margin-bottom: 4px;
    }

    .field-label span {
      opacity: 0.9;
    }

    .field-label small {
      font-size: 11px;
      opacity: 0.85;
    }

    textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 199, 0.5);
      background: rgba(3, 5, 14, 0.95);
      color: var(--fg);
      padding: 10px 11px;
      font-size: 13px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    textarea:focus {
      outline: none;
      border-color: rgba(63, 224, 181, 0.75);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    textarea[readonly] {
      background: radial-gradient(circle at 0 0, rgba(63, 224, 181, 0.12), rgba(3, 5, 14, 0.98));
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 6px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 7px 12px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-blue));
      color: #020617;
      box-shadow: 0 12px 30px rgba(63, 224, 181, 0.5);
    }

    .btn-primary:hover {
      box-shadow: 0 16px 40px rgba(63, 224, 181, 0.65);
    }

    .btn-ghost {
      background: rgba(15, 23, 42, 0.9);
      color: var(--fg-muted);
      border: 1px solid rgba(148, 163, 199, 0.6);
    }

    .btn-ghost:hover {
      border-color: rgba(148, 163, 199, 0.9);
      color: var(--fg);
    }

    .hint {
      font-size: 11px;
      color: var(--fg-muted);
      margin-top: 2px;
    }

    .side {
      padding: 16px 16px 14px;
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 199, 0.35);
      background:
        radial-gradient(circle at 100% 0, rgba(21, 187, 255, 0.22), transparent 55%),
        linear-gradient(145deg, #050816, #02030a);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.65);
      font-size: 13px;
    }

    .side h2 {
      margin: 0 0 8px;
      font-size: 16px;
    }

    .side p {
      margin: 0 0 8px;
      color: var(--fg-muted);
    }

    .side ul {
      margin: 0 0 8px 1.15rem;
      padding: 0;
      color: var(--fg-muted);
    }

    .side li {
      margin-bottom: 4px;
    }

    .badge-soft {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 199, 0.6);
      font-size: 11px;
      color: var(--fg-muted);
      gap: 6px;
    }

    .badge-soft-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #facc15, #f97316);
      box-shadow: 0 0 10px rgba(250, 204, 21, 0.9);
    }

    footer {
      margin-top: 26px;
      padding-top: 14px;
      border-top: 1px solid rgba(15, 23, 42, 0.9);
      font-size: 11px;
      color: var(--fg-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
    }

    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .footer-links a {
      color: var(--fg-muted);
    }

    .footer-links a:hover {
      color: var(--fg);
    }

    /* Abo-Code-Overlay */
    .pro-gate {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background: radial-gradient(circle at top, rgba(5, 8, 20, 0.96), rgba(3, 4, 10, 0.98));
      backdrop-filter: blur(14px);
    }

    .pro-gate-card {
      max-width: 420px;
      width: 100%;
      background: radial-gradient(circle at 0 0, rgba(63, 224, 181, 0.18), rgba(10, 16, 32, 0.98));
      border-radius: 18px;
      border: 1px solid rgba(63, 224, 181, 0.45);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.8);
      padding: 20px 20px 16px;
    }

    .pro-gate-card h1 {
      margin: 0 0 8px;
      font-size: 20px;
    }

    .pro-gate-card p {
      margin: 0 0 10px;
      font-size: 14px;
      color: var(--fg-muted);
    }

    #pro-gate-form {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 4px;
    }

    #pro-gate-input {
      flex: 1 1 160px;
      min-width: 0;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(3, 5, 14, 0.95);
      color: #f5f7ff;
      font-size: 14px;
    }

    #pro-gate-input:focus {
      outline: none;
      border-color: rgba(63, 224, 181, 0.7);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.9);
    }

    #pro-gate-form button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), var(--accent-blue));
      color: #020409;
      box-shadow: 0 12px 30px rgba(63, 224, 181, 0.35);
    }

    #pro-gate-form button:hover {
      box-shadow: 0 16px 40px rgba(63, 224, 181, 0.45);
    }

    .pro-gate-error {
      min-height: 18px;
      font-size: 13px;
      color: var(--danger);
    }

    .pro-gate-hint {
      font-size: 12px;
      color: #8089b0;
    }

    body.pro-active .pro-gate {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Abo-Code-Gate -->
  <div id="pro-gate" class="pro-gate">
    <div class="pro-gate-card">
      <h1>SafeShare Pro freischalten</h1>
      <p>
        Bitte gib deinen SafeShare-Abo-Code ein, um die Pro-Funktionen zu aktivieren.
        Der Code wird nur lokal im Browser gespeichert.
      </p>
      <form id="pro-gate-form">
        <input
          id="pro-gate-input"
          type="text"
          placeholder="Abo-Code eingeben"
          autocomplete="off"
        />
        <button type="submit">Freischalten</button>
      </form>
      <p id="pro-gate-error" class="pro-gate-error" aria-live="polite"></p>
      <p class="pro-gate-hint">
        Du hast noch kein Abo?  
        <a href="https://payhip.com/b/VDm3B" target="_blank" rel="noopener">SafeShare Abo – Personal</a> ·
        <a href="https://payhip.com/b/Yxh5T" target="_blank" rel="noopener">Team-Abo (bis 5 Personen)</a>
      </p>
    </div>
  </div>

  <div class="shell">
    <header class="top-bar">
      <a href="index.html" class="brand">
        <div class="brand-mark">
          <span>8</span>
        </div>
        <div class="brand-text">
          <strong>SafeShare</strong>
          <span>Links ohne Tracking</span>
        </div>
      </a>
      <nav class="nav" aria-label="Hauptnavigation">
        <a href="app.html">App</a>
        <a href="pro.html" class="is-active">Pro</a>
        <a href="utm-parameter-entfernen.html">UTM</a>
        <a href="tracking-parameter-entfernen.html">Tracking</a>
        <a href="url-cleaner-tool-vergleich.html">Tool-Vergleich</a>
        <a href="help.html">Hilfe</a>
      </nav>
    </header>

    <main>
      <section class="card">
        <div class="badge">
          <span class="badge-dot"></span>
          <span>SafeShare Pro App · mehrere Links & eigene Regeln</span>
        </div>
        <h1>Mehrere Links in einem Rutsch bereinigen</h1>
        <p>
          Füge unten eine Liste von Links ein (je Zeile ein Link), lege bei Bedarf eigene Regeln
          für Tracking-Parameter fest und kopiere die bereinigte Liste wieder heraus.
          Alles läuft lokal in deinem Browser.
        </p>

        <div class="io-grid">
          <div>
            <div class="field-label">
              <span>Eingabe – Links (einer pro Zeile)</span>
              <small>z. B. aus Newsletter, Social Media, Dokumenten</small>
            </div>
            <textarea id="input-urls" placeholder="https://example.com/?utm_source=newsletter&#10;https://www.beispiel.de/artikel?fbclid=ABC123&amp;utm_medium=social"></textarea>
          </div>

          <div class="controls-row">
            <button id="btn-clean" class="btn btn-primary" type="button">
              Liste bereinigen
            </button>
            <button id="btn-clear-input" class="btn btn-ghost" type="button">
              Eingabe leeren
            </button>
            <button id="btn-clear-output" class="btn btn-ghost" type="button">
              Ergebnis leeren
            </button>
          </div>

          <div>
            <div class="field-label">
              <span>Ausgabe – bereinigte Links</span>
              <small>werden ohne Tracking-Parameter ausgegeben</small>
            </div>
            <textarea id="output-urls" readonly placeholder="Die bereinigte Liste erscheint hier – je Zeile ein Link."></textarea>
            <div class="controls-row">
              <button id="btn-copy-output" class="btn btn-primary" type="button">
                Bereinigte Liste kopieren
              </button>
            </div>
            <div id="copy-status" class="hint"></div>
          </div>
        </div>
      </section>

      <aside class="side">
        <h2>Eigene Regeln für Tracking-Parameter</h2>
        <p>
          SafeShare Pro kennt bereits eine Standardliste üblicher Tracking-Parameter
          (UTM, fbclid, gclid usw.). Zusätzlich kannst du eigene Regeln ergänzen:
        </p>
        <ul>
          <li><strong>Blacklist:</strong> wird entfernt, wenn nicht explizit auf der Whitelist.</li>
          <li><strong>Whitelist:</strong> darf bleiben – selbst wenn es wie ein Tracking-Parameter aussieht.</li>
        </ul>
        <p class="hint">
          Eintrag je Zeile, nur Parameternamen ohne „?“ oder „=“ (z. B. <code>utm_source</code>).
          Regeln werden im Browser (localStorage) gespeichert, nicht auf einem Server.
        </p>

        <h2>Regeln bearbeiten</h2>

        <div class="field-label">
          <span>Blacklist</span>
          <small>immer entfernen (zusätzlich zu Standardliste)</small>
        </div>
        <textarea id="blacklist-input" placeholder="utm_campaign&#10;mc_eid"></textarea>

        <div class="field-label" style="margin-top:8px;">
          <span>Whitelist</span>
          <small>darf bleiben, auch wenn sonst Tracking-Verdacht besteht</small>
        </div>
        <textarea id="whitelist-input" placeholder="ref"></textarea>

        <div class="controls-row">
          <button id="btn-save-rules" class="btn btn-primary" type="button">
            Regeln speichern
          </button>
          <button id="btn-reset-rules" class="btn btn-ghost" type="button">
            Regeln zurücksetzen
          </button>
        </div>
        <div id="rules-status" class="hint"></div>

        <div style="margin-top:10px;">
          <div class="badge-soft">
            <span class="badge-soft-dot"></span>
            <span>Regeln bleiben auf diesem Gerät / Browser gespeichert</span>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <div>© 2025 Jana Jergus / SafeShare</div>
      <div class="footer-links">
        <a href="index.html">Start</a>
        <a href="app.html">App</a>
        <a href="pro.html">Pro</a>
        <a href="help.html">Hilfe</a>
        <a href="datenschutz.html">Datenschutz</a>
        <a href="impressum.html">Impressum</a>
      </div>
    </footer>
  </div>

<script>
  // ---- Abo-Code-Logik ----
  (function () {
    const VALID_CODES = [
      "SS-PER-1",
      "SS-TEAM-1"
    ];

    function normalizeCode(value) {
      return value.trim().toUpperCase();
    }

    function hasValidCode() {
      try {
        const stored = localStorage.getItem("safeshareProCode");
        if (!stored) return false;
        return VALID_CODES.includes(normalizeCode(stored));
      } catch (e) {
        return false;
      }
    }

    function activatePro(code) {
      try {
        localStorage.setItem("safeshareProCode", normalizeCode(code));
      } catch (e) {}
      document.body.classList.add("pro-active");
    }

    document.addEventListener("DOMContentLoaded", function () {
      const gate = document.getElementById("pro-gate");
      const form = document.getElementById("pro-gate-form");
      const input = document.getElementById("pro-gate-input");
      const error = document.getElementById("pro-gate-error");

      if (!gate || !form || !input) return;

      if (hasValidCode()) {
        activatePro(localStorage.getItem("safeshareProCode") || "");
        return;
      }

      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const value = normalizeCode(input.value);

        if (!value) {
          error.textContent = "Bitte gib deinen Abo-Code ein.";
          return;
        }

        if (!VALID_CODES.includes(value)) {
          error.textContent = "Code ungültig oder abgelaufen.";
          return;
        }

        error.textContent = "";
        activatePro(value);
      });
    });
  })();

  // ---- Pro-App-Logik ----
  (function () {
    const inputEl = document.getElementById("input-urls");
    const outputEl = document.getElementById("output-urls");
    const btnClean = document.getElementById("btn-clean");
    const btnCopy = document.getElementById("btn-copy-output");
    const btnClearInput = document.getElementById("btn-clear-input");
    const btnClearOutput = document.getElementById("btn-clear-output");
    const copyStatus = document.getElementById("copy-status");

    const blacklistInput = document.getElementById("blacklist-input");
    const whitelistInput = document.getElementById("whitelist-input");
    const btnSaveRules = document.getElementById("btn-save-rules");
    const btnResetRules = document.getElementById("btn-reset-rules");
    const rulesStatus = document.getElementById("rules-status");

    const RULES_KEY = "safeshareProRules";

    const DEFAULT_TRACKING_PARAMS = [
      "utm_source",
      "utm_medium",
      "utm_campaign",
      "utm_term",
      "utm_content",
      "utm_id",
      "utm_referrer",
      "utm_name",
      "utm_creative",
      "fbclid",
      "gclid",
      "dclid",
      "msclkid",
      "mc_cid",
      "mc_eid",
      "igshid",
      "si",
      "vero_conv",
      "vero_id",
      "t_ref" // neu: Bild-Ref-Parameter
    ];

    function loadRules() {
      try {
        const raw = localStorage.getItem(RULES_KEY);
        if (!raw) return { blacklist: [], whitelist: [] };
        const parsed = JSON.parse(raw);
        return {
          blacklist: Array.isArray(parsed.blacklist) ? parsed.blacklist : [],
          whitelist: Array.isArray(parsed.whitelist) ? parsed.whitelist : []
        };
      } catch (e) {
        return { blacklist: [], whitelist: [] };
      }
    }

    function saveRulesToStorage(blacklist, whitelist) {
      try {
        localStorage.setItem(
          RULES_KEY,
          JSON.stringify({ blacklist, whitelist })
        );
      } catch (e) {}
    }

    function getRulesFromInputs() {
      const bl = (blacklistInput.value || "")
        .split(/\r?\n/)
        .map((s) => s.trim())
        .filter(Boolean);
      const wl = (whitelistInput.value || "")
        .split(/\r?\n/)
        .map((s) => s.trim())
        .filter(Boolean);
      return { blacklist: bl, whitelist: wl };
    }

    function hydrateRuleInputs() {
      const rules = loadRules();
      if (rules.blacklist.length) {
        blacklistInput.value = rules.blacklist.join("\n");
      }
      if (rules.whitelist.length) {
        whitelistInput.value = rules.whitelist.join("\n");
      }
    }

    function isTrackingParam(name, userBlacklist, userWhitelist) {
      const n = name.toLowerCase();
      const wlSet = new Set(userWhitelist.map((x) => x.toLowerCase()));

      if (wlSet.has(n)) {
        return false;
      }

      if (DEFAULT_TRACKING_PARAMS.includes(n)) {
        return true;
      }

      const blSet = new Set(userBlacklist.map((x) => x.toLowerCase()));
      if (blSet.has(n)) {
        return true;
      }

      return false;
    }

    function tryUnwrapRedirect(url) {
      try {
        const u = new URL(url);

        if (
          (u.hostname === "www.google.com" || u.hostname === "www.google.de") &&
          (u.pathname === "/url" || u.pathname === "/local_url")
        ) {
          const target = u.searchParams.get("q") || u.searchParams.get("url");
          if (target) return target;
        }

        if (u.hostname === "l.facebook.com") {
          const target = u.searchParams.get("u");
          if (target) return target;
        }

        return url;
      } catch (e) {
        return url;
      }
    }

    function cleanSingleUrl(raw, rules) {
      const trimmed = raw.trim();
      if (!trimmed) return "";

      let current = tryUnwrapRedirect(trimmed);

      try {
        const u = new URL(current);
        const newSearch = new URLSearchParams();

        for (const [key, value] of u.searchParams.entries()) {
          if (!isTrackingParam(key, rules.blacklist, rules.whitelist)) {
            newSearch.append(key, value);
          }
        }

        u.search = newSearch.toString();
        return u.toString();
      } catch (e) {
        return trimmed;
      }
    }

    function cleanList() {
      const input = inputEl.value || "";
      const lines = input.split(/\r?\n/);
      const rulesFromInputs = getRulesFromInputs();
      const rules = rulesFromInputs.blacklist.length || rulesFromInputs.whitelist.length
        ? rulesFromInputs
        : loadRules();

      const cleanedLines = lines
        .map((line) => cleanSingleUrl(line, rules))
        .filter((l) => l !== "");
      outputEl.value = cleanedLines.join("\n");
      copyStatus.textContent = "";
    }

    function copyOutput() {
      const value = outputEl.value || "";
      if (!value.trim()) {
        copyStatus.textContent = "Kein Ergebnis zum Kopieren.";
        return;
      }
      try {
        navigator.clipboard.writeText(value).then(
          () => {
            copyStatus.textContent = "Bereinigte Liste wurde in die Zwischenablage kopiert.";
          },
          () => {
            copyStatus.textContent = "Konnte nicht automatisch kopieren – bitte manuell markieren & kopieren.";
          }
        );
      } catch (e) {
        copyStatus.textContent = "Konnte nicht automatisch kopieren – bitte manuell markieren & kopieren.";
      }
    }

    function clearInput() {
      inputEl.value = "";
    }

    function clearOutput() {
      outputEl.value = "";
      copyStatus.textContent = "";
    }

    function saveRules() {
      const { blacklist, whitelist } = getRulesFromInputs();
      saveRulesToStorage(blacklist, whitelist);
      rulesStatus.textContent = "Regeln wurden lokal gespeichert.";
    }

    function resetRules() {
      blacklistInput.value = "";
      whitelistInput.value = "";
      saveRulesToStorage([], []);
      rulesStatus.textContent = "Regeln wurden zurückgesetzt.";
    }

    document.addEventListener("DOMContentLoaded", function () {
      hydrateRuleInputs();

      btnClean.addEventListener("click", cleanList);
      btnCopy.addEventListener("click", copyOutput);
      btnClearInput.addEventListener("click", clearInput);
      btnClearOutput.addEventListener("click", clearOutput);
      btnSaveRules.addEventListener("click", saveRules);
      btnResetRules.addEventListener("click", resetRules);
    });
  })();
</script>
</body>
</html>
